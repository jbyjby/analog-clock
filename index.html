<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•„ë‚ ë¡œê·¸ ì‹œê³„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
            touch-action: none;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8 overflow-hidden">
    <div class="bg-white rounded-3xl shadow-2xl p-8 relative">
        <button
            id="captureBtn"
            class="absolute top-6 right-6 px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 active:bg-indigo-800 transition-colors shadow-md"
        >
            ğŸ“¸ ìº¡ì²˜
        </button>

        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">
            ì•„ë‚ ë¡œê·¸ ì‹œê³„
        </h1>

        <div
            id="clockContainer"
            class="relative w-80 h-80 mb-8 select-none"
        >
            <div id="clock" class="w-full h-full">
                <!-- SVG ì‹œê³„ ë°°ê²½ -->
                <svg class="absolute inset-0 w-full h-full" viewBox="0 0 320 320">
                    <!-- ì‹œê³„ í…Œë‘ë¦¬ -->
                    <circle cx="160" cy="160" r="156" fill="white" stroke="#1f2937" stroke-width="8"/>

                    <!-- ë¶„ ëˆˆê¸ˆ -->
                    <g id="ticks"></g>
                </svg>

                <!-- ì‹œê³„ ìˆ«ì -->
                <div id="numbers"></div>

                <!-- ì¤‘ì‹¬ì  -->
                <div class="absolute left-1/2 top-1/2 w-4 h-4 bg-red-500 rounded-full transform -translate-x-1/2 -translate-y-1/2 z-30"></div>

                <!-- ë¶„ì¹¨ í´ë¦­ ì˜ì—­ -->
                <div
                    id="minuteHandArea"
                    class="absolute left-1/2 bottom-1/2 origin-bottom cursor-grab active:cursor-grabbing z-10"
                    style="width: 40px; height: 140px; transform: translateX(-50%) rotate(0deg); transition: transform 0.3s ease;"
                >
                    <!-- ì‹¤ì œ ë¶„ì¹¨ -->
                    <div class="absolute left-1/2 bottom-0 w-2 h-[120px] bg-blue-600 rounded-t-full transform -translate-x-1/2 pointer-events-none"></div>
                </div>

                <!-- ì‹œì¹¨ -->
                <div
                    id="hourHand"
                    class="absolute left-1/2 bottom-1/2 w-2 bg-gray-800 origin-bottom rounded-t-full z-20"
                    style="height: 80px; transform: translateX(-50%) rotate(0deg); transition: transform 0.3s ease;"
                ></div>
            </div>
        </div>

        <div class="text-center space-y-3 mb-6">
            <div id="digitalTime" class="text-3xl font-semibold text-gray-800">
                12ì‹œ 0ë¶„
            </div>
            <div id="koreanTime" class="text-3xl font-semibold text-indigo-600">
                12ì‹œ ì •ê°
            </div>
            <div class="text-sm text-gray-500 mt-4">
                ğŸ’¡ íŒŒë€ ë¶„ì¹¨ì„ ë“œë˜ê·¸í•´ì„œ ì‹œê°„ì„ ì¡°ì •í•˜ì„¸ìš”!
            </div>
        </div>
    </div>

    <script>
        let totalMinutes = 0;
        let isDragging = false;
        let lastAngle = null;

        const clock = document.getElementById('clock');
        const clockContainer = document.getElementById('clockContainer');
        const minuteHandArea = document.getElementById('minuteHandArea');
        const hourHand = document.getElementById('hourHand');
        const digitalTime = document.getElementById('digitalTime');
        const koreanTime = document.getElementById('koreanTime');
        const captureBtn = document.getElementById('captureBtn');

        function getCurrentHours() {
            return Math.floor(totalMinutes / 60);
        }

        function getCurrentMins() {
            return Math.round(totalMinutes % 60);
        }

        function getDisplayHours() {
            return getCurrentHours() % 12 || 12;
        }

        function getMinuteAngle() {
            return (getCurrentMins() / 60) * 360;
        }

        function getHourAngle() {
            return ((getDisplayHours() + getCurrentMins() / 60) / 12) * 360;
        }

        function getAngleFromMouse(e) {
            const rect = clock.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            const mouseX = e.clientX || e.touches?.[0]?.clientX;
            const mouseY = e.clientY || e.touches?.[0]?.clientY;

            const dx = mouseX - centerX;
            const dy = mouseY - centerY;

            let angle = Math.atan2(dy, dx) * (180 / Math.PI) + 90;
            if (angle < 0) angle += 360;

            return angle;
        }

        function getKoreanTime() {
            const h = getDisplayHours();
            const m = getCurrentMins();

            if (m === 0) {
                return `${h}ì‹œ ì •ê°`;
            } else if (m < 30) {
                return `${h}ì‹œ ${m}ë¶„`;
            } else if (m === 30) {
                return `${h}ì‹œ 30ë¶„`;
            } else {
                const nextHour = h === 12 ? 1 : h + 1;
                const remaining = 60 - m;
                return `${nextHour}ì‹œ ${remaining}ë¶„ ì „`;
            }
        }

        function updateDisplay() {
            const minuteAngle = getMinuteAngle();
            const hourAngle = getHourAngle();

            minuteHandArea.style.transform = `translateX(-50%) rotate(${minuteAngle}deg)`;
            hourHand.style.transform = `translateX(-50%) rotate(${hourAngle}deg)`;

            digitalTime.textContent = `${getDisplayHours()}ì‹œ ${getCurrentMins()}ë¶„`;
            koreanTime.textContent = getKoreanTime();
        }

        function handleMouseDown(e) {
            e.stopPropagation();
            e.preventDefault();
            isDragging = true;
            lastAngle = getAngleFromMouse(e);

            minuteHandArea.style.transition = 'none';
            hourHand.style.transition = 'none';
            clockContainer.style.cursor = 'grabbing';
        }

        function handleMouseMove(e) {
            if (!isDragging || lastAngle === null) return;

            e.preventDefault();

            const angle = getAngleFromMouse(e);
            let delta = angle - lastAngle;

            if (delta > 180) {
                delta -= 360;
            } else if (delta < -180) {
                delta += 360;
            }

            const minutesDelta = (delta / 360) * 60;
            totalMinutes += minutesDelta;

            if (totalMinutes < 0) {
                totalMinutes += 720;
            }

            lastAngle = angle;
            updateDisplay();
        }

        function handleMouseUp() {
            isDragging = false;
            lastAngle = null;

            minuteHandArea.style.transition = 'transform 0.3s ease';
            hourHand.style.transition = 'transform 0.3s ease';
            clockContainer.style.cursor = 'default';
        }

        function createTicks() {
            const ticksGroup = document.getElementById('ticks');

            for (let i = 0; i < 60; i++) {
                const isBigTick = i % 5 === 0;
                const angle = i * 6;
                const length = isBigTick ? 12 : 6;
                const width = isBigTick ? 2.5 : 1.5;
                const startR = 152 - length;
                const endR = 152;

                const x1 = 160 + startR * Math.sin((angle * Math.PI) / 180);
                const y1 = 160 - startR * Math.cos((angle * Math.PI) / 180);
                const x2 = 160 + endR * Math.sin((angle * Math.PI) / 180);
                const y2 = 160 - endR * Math.cos((angle * Math.PI) / 180);

                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', x1);
                line.setAttribute('y1', y1);
                line.setAttribute('x2', x2);
                line.setAttribute('y2', y2);
                line.setAttribute('stroke', '#374151');
                line.setAttribute('stroke-width', width);
                line.setAttribute('stroke-linecap', 'round');

                ticksGroup.appendChild(line);
            }
        }

        function createNumbers() {
            const numbersContainer = document.getElementById('numbers');

            [12, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11].forEach((num, idx) => {
                const angle = (idx * 30 - 90) * (Math.PI / 180);
                const x = 140 * Math.cos(angle);
                const y = 140 * Math.sin(angle);

                const numberDiv = document.createElement('div');
                numberDiv.className = 'absolute text-2xl font-bold text-gray-700';
                numberDiv.style.left = '50%';
                numberDiv.style.top = '50%';
                numberDiv.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
                numberDiv.textContent = num;

                numbersContainer.appendChild(numberDiv);
            });
        }

        function downloadImage(blob, fileName) {
            const link = document.createElement('a');
            link.download = fileName;
            link.href = URL.createObjectURL(blob);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
            alert('âœ… ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        async function handleCapture() {
            console.log('ìº¡ì²˜ ì‹œì‘');

            try {
                const canvas = document.createElement('canvas');
                const size = 800;
                canvas.width = size;
                canvas.height = size;
                const ctx = canvas.getContext('2d');

                // ë°°ê²½ ê·¸ë¦¬ê¸°
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, size, size);

                const centerX = size / 2;
                const centerY = size / 2;
                const radius = size * 0.4;

                // ì‹œê³„ í…Œë‘ë¦¬ ê·¸ë¦¬ê¸°
                ctx.strokeStyle = '#1f2937';
                ctx.lineWidth = 8;
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                ctx.stroke();

                // ë¶„ ëˆˆê¸ˆ ê·¸ë¦¬ê¸°
                for (let i = 0; i < 60; i++) {
                    const isBigTick = i % 5 === 0;
                    const angle = (i * 6 - 90) * (Math.PI / 180);
                    const length = isBigTick ? 12 : 6;
                    const width = isBigTick ? 2.5 : 1.5;

                    const startR = radius - length;
                    const endR = radius;

                    const x1 = centerX + startR * Math.cos(angle);
                    const y1 = centerY + startR * Math.sin(angle);
                    const x2 = centerX + endR * Math.cos(angle);
                    const y2 = centerY + endR * Math.sin(angle);

                    ctx.strokeStyle = '#374151';
                    ctx.lineWidth = width;
                    ctx.lineCap = 'round';
                    ctx.beginPath();
                    ctx.moveTo(x1, y1);
                    ctx.lineTo(x2, y2);
                    ctx.stroke();
                }

                // ì‹œê³„ ìˆ«ì ê·¸ë¦¬ê¸°
                ctx.fillStyle = '#374151';
                ctx.font = 'bold 48px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';

                [12, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11].forEach((num, idx) => {
                    const angle = (idx * 30 - 90) * (Math.PI / 180);
                    const x = centerX + (radius * 0.85) * Math.cos(angle);
                    const y = centerY + (radius * 0.85) * Math.sin(angle);
                    ctx.fillText(num.toString(), x, y);
                });

                // ì‹œì¹¨ ê·¸ë¦¬ê¸°
                const hourLen = radius * 0.5;
                const hourAngleRad = ((getHourAngle() - 90) * Math.PI) / 180;
                ctx.strokeStyle = '#1f2937';
                ctx.lineWidth = 8;
                ctx.lineCap = 'round';
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(
                    centerX + hourLen * Math.cos(hourAngleRad),
                    centerY + hourLen * Math.sin(hourAngleRad)
                );
                ctx.stroke();

                // ë¶„ì¹¨ ê·¸ë¦¬ê¸°
                const minuteLen = radius * 0.75;
                const minuteAngleRad = ((getMinuteAngle() - 90) * Math.PI) / 180;
                ctx.strokeStyle = '#2563eb';
                ctx.lineWidth = 6;
                ctx.lineCap = 'round';
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(
                    centerX + minuteLen * Math.cos(minuteAngleRad),
                    centerY + minuteLen * Math.sin(minuteAngleRad)
                );
                ctx.stroke();

                // ì¤‘ì‹¬ì  ê·¸ë¦¬ê¸°
                ctx.fillStyle = '#ef4444';
                ctx.beginPath();
                ctx.arc(centerX, centerY, 8, 0, Math.PI * 2);
                ctx.fill();

                // ì´ë¯¸ì§€ë¥¼ data URLë¡œ ë³€í™˜
                const dataURL = canvas.toDataURL('image/png');

                // iOS/iPadOS ì²´í¬
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);

                if (isIOS) {
                    // iOSì—ì„œëŠ” ì´ë¯¸ì§€ë¥¼ ìƒˆ ì°½ì— í‘œì‹œí•´ì„œ ì‚¬ìš©ìê°€ ê¸¸ê²Œ ëˆŒëŸ¬ ì €ì¥í•  ìˆ˜ ìˆë„ë¡ í•¨
                    const newWindow = window.open('', '_blank');
                    newWindow.document.write(`
                        <html>
                            <head>
                                <title>ì‹œê³„ ì´ë¯¸ì§€ - ${getDisplayHours()}ì‹œ ${getCurrentMins()}ë¶„</title>
                                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                                <style>
                                    body {
                                        margin: 0;
                                        padding: 20px;
                                        background: #f3f4f6;
                                        display: flex;
                                        flex-direction: column;
                                        align-items: center;
                                        font-family: -apple-system, BlinkMacSystemFont, sans-serif;
                                    }
                                    .instructions {
                                        background: white;
                                        padding: 15px;
                                        border-radius: 10px;
                                        margin-bottom: 20px;
                                        text-align: center;
                                        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                                    }
                                    .instructions h3 {
                                        margin: 0 0 10px 0;
                                        color: #1f2937;
                                    }
                                    .instructions p {
                                        margin: 5px 0;
                                        color: #6b7280;
                                        font-size: 14px;
                                    }
                                    img {
                                        max-width: 100%;
                                        height: auto;
                                        border-radius: 10px;
                                        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
                                    }
                                </style>
                            </head>
                            <body>
                                <div class="instructions">
                                    <h3>ğŸ“¸ ì‚¬ì§„ ì €ì¥ ë°©ë²•</h3>
                                    <p>ì•„ë˜ ì´ë¯¸ì§€ë¥¼ <strong>ê¸¸ê²Œ ëˆŒëŸ¬ì£¼ì„¸ìš”</strong></p>
                                    <p>ë©”ë‰´ì—ì„œ <strong>"ì‚¬ì§„ì— ì €ì¥"</strong>ì„ ì„ íƒí•˜ì„¸ìš”</p>
                                </div>
                                <img src="${dataURL}" alt="ì‹œê³„ ì´ë¯¸ì§€ - ${getDisplayHours()}ì‹œ ${getCurrentMins()}ë¶„" />
                            </body>
                        </html>
                    `);
                    newWindow.document.close();
                } else {
                    // ì•ˆë“œë¡œì´ë“œë‚˜ ë°ìŠ¤í¬í†±ì—ì„œëŠ” ê¸°ì¡´ ë°©ì‹ ì‚¬ìš©
                    canvas.toBlob(async (blob) => {
                        const fileName = `ì‹œê³„_${getDisplayHours()}ì‹œ${getCurrentMins()}ë¶„.png`;

                        if (navigator.share && navigator.canShare && navigator.canShare({ files: [new File([blob], fileName, { type: 'image/png' })] })) {
                            try {
                                const file = new File([blob], fileName, { type: 'image/png' });
                                await navigator.share({
                                    files: [file],
                                    title: 'ì‹œê³„ ìº¡ì²˜'
                                });
                            } catch (err) {
                                if (err.name !== 'AbortError') {
                                    downloadImage(blob, fileName);
                                }
                            }
                        } else {
                            downloadImage(blob, fileName);
                        }
                    }, 'image/png');
                }

            } catch (error) {
                console.error('ìº¡ì²˜ ì‹¤íŒ¨:', error);
                alert('ìº¡ì²˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        minuteHandArea.addEventListener('mousedown', handleMouseDown);
        minuteHandArea.addEventListener('touchstart', handleMouseDown);

        window.addEventListener('mousemove', handleMouseMove);
        window.addEventListener('mouseup', handleMouseUp);
        window.addEventListener('touchmove', handleMouseMove, { passive: false });
        window.addEventListener('touchend', handleMouseUp);

        captureBtn.addEventListener('click', handleCapture);

        // ì´ˆê¸°í™”
        createTicks();
        createNumbers();
        updateDisplay();
    </script>
</body>
</html>